CREATE TABLE IF NOT EXISTS availability(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    description VARCHAR(100) NOT NULL    
);

CREATE TABLE IF NOT EXISTS movies(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    title VARCHAR(500) NOT NULL CHECK (title <> ''),
    description TEXT NOT NULL,
    stock INTEGER NOT NULL,
    rental_price MONEY NOT NULL,
    sale_price MONEY NOT NULL,
    id_availability INTEGER NOT NULL REFERENCES availability(id)
);

CREATE TABLE IF NOT EXISTS log_movies(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    title VARCHAR(500) NOT NULL CHECK (title <> ''),
    rental_price MONEY NOT NULL,
    sale_price MONEY NOT NULL,
    id_movie INTEGER NOT NULL REFERENCES movies (id)
);

CREATE TABLE IF NOT EXISTS image_movies(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    image BYTEA NOT NULL,
    id_movie INTEGER NOT NULL REFERENCES movies(id)
);

CREATE TABLE IF NOT EXISTS type_users(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    description VARCHAR(100) NOT NULL CHECK (description <> '')
);

CREATE TABLE IF NOT EXISTS users(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    first_name VARCHAR(100) NOT NULL CHECK (first_name <> ''),
    last_name VARCHAR(100) NOT NULL CHECK (last_name <> ''),
    date_of_birth TIMESTAMP NOT NULL,  
	login varchar(100) NOT NULL,
    email varchar(150) NOT NULL,
	password varchar(100) NOT NULL,
    id_type INTEGER NOT NULL REFERENCES type_users(id)
);

CREATE TABLE IF NOT EXISTS rent_movies(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    date_rental TIMESTAMP NOT NULL,
    date_return TIMESTAMP NOT NULL,
    id_movie INTEGER NOT NULL REFERENCES movies(id),
    id_user INTEGER NOT NULL REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS sale_movies(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    date_sale TIMESTAMP NOT NULL,
    units INTEGER NOT NULL,
    id_movie INTEGER NOT NULL REFERENCES movies(id),
    id_user INTEGER NOT NULL REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS likes_movies(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    id_movie INTEGER NOT NULL REFERENCES movies(id),
    id_user INTEGER NOT NULL REFERENCES users(id)
);

